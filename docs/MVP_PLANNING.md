# 🦁 LIFE MVP 기획서
**Living Intelligence for Fauna Ecosystem - 야생동물 포획 RPG**

## 📖 게임 컨셉

### 핵심 아이디어
포켓몬 스타일의 **아프리카 사바나 야생동물 포획 게임**
- 🎮 **장르**: 2D 탑뷰 RPG + 포획 시스템 + FPS 액션
- 🌍 **배경**: 아프리카 사바나, 정글, 사막 등 야생 생태계
- 🎯 **목표**: 야생동물을 포획하여 조련사로 성장하기

### 게임플레이 흐름
1. **탐험** → 필드를 돌아다니며 야생동물 발견
2. **전투** → 야생동물과 실시간 액션 전투 시스템
3. **포획** → 약화된 동물을 포획구로 포획
4. **성장** → 포획한 동물 육성 및 장비 수집/제작으로 성능 향상
5. **도전** → 더 강한 동물과 새로운 서식지 탐험

---

## 🎮 MVP 핵심 기능

### 1. 조련사 시스템
- **기본 스탯**: 레벨, 경험치, HP
- **이동**: WASD 키로 자유로운 이동
- **전투**: 마우스 좌클릭으로 총 발사 (FPS 스타일)
- **인벤토리**: 포획구, 회복 아이템, 무기, 탄약 보관
- **포획 동물 관리**: 최대 6마리 파티 구성
- **장비 시스템**: 무기, 방어구로 성능 향상

### 2. 야생동물 시스템
#### 동물 종류 (MVP - 3종류)
- **사자** 🦁 - 높은 공격력, 빠른 공격속도
- **코끼리** 🐘 - 높은 HP와 방어력, 느린 이동/공격속도  
- **치타** 🐆 - 빠른 이동속도, 중간 공격력

#### 동물 스탯
```
- HP: 체력
- ATK: 공격력  
- DEF: 방어력
- SPD: 이동속도
- AS: 공격속도 (공격 간 쿨다운)
```

### 3. 전투 시스템
#### 실시간 FPS 전투
1. **조우**: 필드에서 야생동물과 실시간으로 조우
2. **전투 시작**: 별도 화면 전환 없이 필드에서 바로 전투
3. **FPS 액션**: WASD로 이동, 마우스로 조준 및 발사
4. **승부 결과**: 야생동물 HP를 낮춰서 포획 확률 증가

#### 전투 조작법
- **이동**: WASD - 자유로운 이동
- **조준**: 마우스 - 크로스헤어로 조준
- **발사**: 마우스 좌클릭 - 총 발사 (탄약 소모)
- **재장전**: R키 - 탄창 재장전
- **포획**: F키 - 포획구 던지기 (HP가 낮을수록 성공률 증가)
- **아이템**: 숫자 키 1-5 - 회복 아이템 사용
- **동물 교체**: Tab키 - 보유 동물 간 실시간 교체

### 4. 장비 시스템
#### 장비 종류 (MVP)
- **총기**: 공격력 및 사거리 증가 (권총 → 라이플 → 저격총)
- **탄약**: 다양한 총알 종류 (일반탄 → 마취탄 → 특수탄)
- **방어구**: HP와 방어력 증가 (가죽 갑옷 → 철 갑옷)
- **포획구**: 포획 성공률 증가 (기본 → 개선형 → 마스터급)

#### 장비 획득 방법
- **제작**: 필드에서 획득한 재료로 장비 제작
- **상점**: 마을에서 골드로 구매
- **드롭**: 강한 야생동물 처치 시 희귀 재료 드롭

#### 동물 장비
- **목걸이**: 동물의 ATK/DEF/SPD 중 하나를 향상
- **간단한 시스템**: 슬롯 1개, 장비 교체 가능

### 5. 필드 탐험 시스템
#### 맵 구성 (MVP - 1개 맵)
- **사바나 평원**: 30x20 타일 크기의 2D 맵
- **지형 요소**: 풀숲, 바위, 나무, 물웅덩이
- **동물 서식지**: 특정 지역에 특정 동물 출현

#### 실시간 야생동물 시스템
- **동물 스폰**: 맵 곳곳에 야생동물이 실시간으로 스폰
- **AI 행동**: 야생동물이 자유롭게 돌아다니며, 플레이어 접근 시 반응
- **전투 트리거**: 플레이어가 야생동물에게 접근하면 자동으로 전투 시작
- **도망 시스템**: 전투 중 일정 거리 이상 멀어지면 전투 해제

---

## 🏗️ 기술 구현 방향

### 아키텍처 원칙
- **Stateless Server**: 서버 메모리에 상태 저장 금지, 모든 상태는 Redis에 저장
- **Event-Driven**: 게임 액션은 이벤트로 처리, Redis Streams 활용
- **HTTP Only**: WebSocket 사용 안함, POST API + SSE로 실시간 통신
- **CQRS**: Command(쓰기)와 Query(읽기) 분리

### 클라이언트 (게임 화면)
- **엔진**: Unity 2D 또는 웹 기반 Canvas
- **뷰**: 2D 탑뷰 스프라이트 방식 + FPS 크로스헤어
- **UI**: 인벤토리, 전투 화면, 상태창, 탄약 표시, 조준점
- **실시간 통신**: SSE 우선, 연결 실패 시 개별 API로 폴백

### 서버 (게임 로직) - Authoritative Server 아키텍처
```
# ===============================
# OAuth 기반 인증 시스템
# ===============================
GET  /api/auth/oauth/{provider}     - OAuth 로그인 시작 (Google, GitHub, Discord)
  Response: {"auth_url": "https://accounts.google.com/oauth2/auth?..."}

POST /api/auth/oauth/callback       - OAuth 콜백 처리
  Request: {"provider": "google", "code": "oauth_code", "state": "csrf_token"}
  Response: {"jwt_token": "eyJ...", "user_id": "user_123", "expires_in": 86400}

POST /api/auth/refresh              - JWT 토큰 갱신
POST /api/auth/logout               - 로그아웃

# ===============================
# 멀티플레이어 게임 세션 관리
# ===============================
POST /api/game/create        - 새로운 게임 세션 생성 (JWT 인증)
  Headers: {"Authorization": "Bearer eyJ..."}
  Response: {"game_id": "game_123", "session_token": "sess_abc123"}

POST /api/game/join          - 기존 게임 세션 참가 (JWT 인증)
  Headers: {"Authorization": "Bearer eyJ..."}
  Request: {"game_id": "game_123"}
  Response: {"session_token": "sess_abc123", "player_id": "player_456"}

POST /api/game/leave         - 게임 세션 나가기 (세션 토큰)
POST /api/game/list          - 참가 가능한 게임 목록 조회 (JWT 인증)

# ===============================
# 실시간 플레이어 입력 (고빈도)
# ===============================
POST /api/input/movement     - 이동 방향 벡터 (사건 기반, JWT 인증)
  Headers: {"Authorization": "Bearer eyJ..."}
  {
    "game_id": "xxx", 
    "direction": {
      "x": 0.707,    // 우상향 이동 (√2/2 ≈ 0.707)
      "y": 0.707     // 정규화된 방향 벡터 (-1.0 ~ 1.0)
    },
    "timestamp": "2024-01-01T10:00:00Z",
    "sequence": 12345,
    "type": "change"  // "change" (방향 변화) 또는 "stop" (정지)
  }
  
  # 방향 벡터 예시:
  # 정지: {"x": 0, "y": 0}
  # 북쪽: {"x": 0, "y": 1}
  # 남동쪽: {"x": 0.707, "y": -0.707}
  # 서쪽: {"x": -1, "y": 0}
  
  # 서버 응답: 실제 계산된 위치
  Response: {
    "player_id": "xxx",
    "new_position": {"x": 10.5, "y": 15.3},
    "velocity": {"x": 1.4, "y": 1.4},
    "tick": 12345
  }

POST /api/input/shoot        - 발사 의도 (마우스 좌클릭, JWT 인증)
  Headers: {"Authorization": "Bearer eyJ..."}
  {
    "game_id": "xxx",
    "aim_direction": {"x": 0.8, "y": 0.6},  // 조준 방향만 전송
    "shoot_pressed": true,                   // 발사 버튼 의도
    "timestamp": "2024-01-01T10:00:00Z",
    "sequence": 12346
  }
  
  # 서버 응답: 실제 발사 결과
  Response: {
    "success": true,
    "projectile_id": "proj_12345",
    "trajectory": {
      "start": {"x": 10.5, "y": 15.3},
      "end": {"x": 25.8, "y": 22.1}
    },
    "hit_result": {
      "target_type": "animal",  // "player", "animal", "terrain"
      "target_id": "lion_001",
      "damage": 35
    },
    "ammo_remaining": 24,
    "tick": 12346
  }

POST /api/input/reload       - 재장전 입력 (R키)
POST /api/input/capture      - 포획 시도 입력 (F키)

# ===============================
# 게임 상태 조회 (저빈도)
# ===============================
POST /api/state/world        - 현재 월드 전체 상태
  Response: {
    "game_id": "xxx",
    "tick": 12345,
    "players": [
      {
        "id": "player_1",
        "position": {"x": 10, "y": 15},
        "health": 100,
        "weapon": "rifle_001",
        "ammo": 25
      }
    ],
    "animals": [...],
    "projectiles": [...]
  }

POST /api/state/player       - 특정 플레이어 상태
POST /api/state/area         - 특정 영역 상태 (Area of Interest)

# ===============================
# 실시간 이벤트 스트림 (SSE)
# ===============================
GET  /api/events/game/{game_id}  - 게임별 실시간 이벤트 스트림
  Events:
  - player_moved: {"player_id": "xxx", "position": {...}}
  - player_shot: {"player_id": "xxx", "projectile": {...}}
  - player_hit: {"target_id": "xxx", "damage": 25}
  - animal_spawned: {"animal": {...}}
  - projectile_created: {"projectile": {...}}
  - projectile_hit: {"target": "xxx", "damage": 25}

# ===============================
# 장비 및 인벤토리 관리
# ===============================
POST /api/equipment/equip    - 장비 착용/해제
POST /api/equipment/craft    - 장비 제작
POST /api/inventory/items    - 인벤토리 아이템 목록
```

### 데이터 저장
- **플레이어 데이터**: 레벨, 위치, 보유 동물, 총기, 탄약, 인벤토리
- **동물 데이터**: 종류, 레벨, 스탯 (HP/ATK/DEF/SPD/AS), 착용 장비
- **장비 데이터**: 총기 종류, 탄약 종류, 등급, 스탯 보너스 (HP/ATK/DEF/SPD/AS)
- **맵 상태**: 플레이어 위치, 동물 출현 정보, 탄알 궤적

---

## 🤔 논의 포인트

### 1. 전투 밸런스
- 포획 확률 공식: `(1 - currentHP/maxHP) * 포획구성능 * 랜덤요소`

### 2. 게임 진행
- 플레이어가 더 강한 동물을 찾아가는 동기 부여 방법?
- 새로운 서식지 해금 조건 (레벨? 특정 동물 포획?)

### 3. 사용자 경험
- 전투가 너무 반복적이지 않게 하려면?
- 포획 실패 시 좌절감을 줄이는 방법?

### 4. 멀티플레이어 FPS 기술적 고려사항

#### **Authoritative Server 원칙**
- **서버가 절대적 진실**: 모든 위치, 히트 판정, 데미지는 서버에서만 결정
- **클라이언트는 의도만 전송**: WASD 키 상태, 마우스 클릭, 조준 방향
- **즉시 응답**: 각 입력에 대해 서버가 즉시 계산 결과 반환
- **시퀀스 넘버**: 패킷 순서 및 중복 방지

#### **입력 전송 전략 (하이브리드 방식)**

**이벤트 기반 + 주기적 동기화**
```
1. 방향 변화시 즉시 전송
   - 이동 시작: {"direction": {"x": 0.707, "y": 0.707}, "type": "change"}  
   - 정지: {"direction": {"x": 0, "y": 0}, "type": "change"}
   - 방향 변경: {"direction": {"x": -1, "y": 0}, "type": "change"}

2. 주기적 동기화 (30Hz)
   - 현재 방향 벡터 전송: {"direction": {"x": 0.707, "y": 0.707}, "type": "sync"}
   - 패킷 손실 복구 및 상태 일관성 보장

3. 네트워크 적응
   - 고지연시: 이벤트 빈도 줄이고 동기화 빈도 증가
   - 저지연시: 이벤트 위주, 동기화 빈도 감소
```

**장점:**
- 더 적은 데이터: 2개 float vs 4개 boolean
- 더 정확한 방향: 8방향 + 정지 vs 무한 방향
- 확장성: 아날로그 스틱, 마우스 이동 지원 가능

#### **네트워크 최적화**
- **이벤트 기반**: 상태 변화시만 전송으로 대역폭 절약
- **주기적 동기화**: 패킷 손실 복구 및 일관성 보장
- **적응형 전송**: 네트워크 상태에 따라 주기 조정
- **Area of Interest**: 근처 플레이어/동물만 업데이트

#### **레이턴시 해결**
- **클라이언트 예측**: 로컬에서 즉시 UI 반영, 서버 응답 후 보정
- **래그 보상**: 서버에서 플레이어 과거 위치 기반 히트 판정
- **보간**: 다른 플레이어 움직임 부드럽게 표시

#### **Redis 기반 상태 관리**
- **게임 세션**: `game:{game_id}` → 전체 게임 상태
- **플레이어 상태**: `player:{game_id}:{player_id}` → 개별 플레이어
- **실시간 이벤트**: Redis Streams로 이벤트 발행/구독
- **Stateless 설계**: 서버 재시작 시에도 게임 상태 유지

#### **JWT 성능 테스트 계획**
- **측정 지표**: JWT 검증 시간, CPU 사용률, 메모리 사용량
- **부하 테스트**: 동시 사용자 10/50/100명으로 점진적 증가
- **시나리오**: 
  ```
  1. 정적 테스트: 플레이어 정지 상태 (JWT 검증 없음)
  2. 이동 테스트: 방향 변경 빈도별 (초당 1/5/10회)
  3. 전투 테스트: 발사 + 이동 조합
  4. 피크 테스트: 모든 플레이어 동시 액션
  ```
- **성능 임계점**: JWT 검증이 전체 응답 시간의 50% 초과시 세션 토큰 전환
- **최적화 옵션**: 
  ```
  Phase 1: JWT 직접 검증 (baseline)
  Phase 2: JWT 캐싱 (Redis)  
  Phase 3: 세션 토큰 도입 (필요시)
  ```

#### **성능 및 확장성**
- **틱 기반 시뮬레이션**: 60Hz 또는 120Hz 고정 주기로 물리 계산
- **배치 처리**: 여러 입력을 모아서 한번에 처리
- **이중화 통신**: SSE 실패 시 개별 REST API로 폴백
- **수평 확장**: 게임별로 서버 인스턴스 분산
- **인증 최적화**: 성능 테스트 결과에 따라 JWT vs 세션 토큰 선택

---

**어떤 부분을 더 자세히 논의해볼까요? 🎮**