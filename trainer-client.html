<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life Game - Trainer Movement</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fast-json-patch/3.1.1/fast-json-patch.min.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'game-green': '#228B22',
                        'trainer-red': '#ff4444',
                        'trainer-blue': '#4444ff'
                    },
                    animation: {
                        'pulse-glow': 'pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite'
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom styles for game elements that need precise positioning */
        .trainer {
            position: absolute;
            transform: translate(-50%, -50%);
        }
        
        .other-trainer {
            position: absolute;
            transform: translate(-50%, -50%);
        }
        
        .trainer.moving {
            box-shadow: 0 0 10px rgba(255, 68, 68, 0.5);
        }
        
        .other-trainer.moving {
            box-shadow: 0 0 8px rgba(68, 68, 255, 0.5);
        }
        
        /* Map background with grid pattern for better visual feedback */
        .map-container {
            background-color: white;
            background-image: 
                linear-gradient(rgba(0,0,0,0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0,0,0,0.1) 1px, transparent 1px);
            background-size: 30px 30px;
        }
    </style>
</head>
<body class="m-0 p-5 bg-blue-50 font-sans">
    <div class="max-w-6xl mx-auto">
        <h1 class="text-3xl font-bold text-gray-800 mb-6">🌍 Life Game - Trainer Movement</h1>
        
        <!-- Authentication Section -->
        <div class="bg-white p-5 rounded-lg mb-5 shadow-lg" id="auth-section">
            <h3 class="text-xl font-semibold text-gray-700 mb-4">🎮 Guest Login to Start Playing</h3>
            <input type="text" 
                   id="nickname" 
                   placeholder="Enter your nickname (3-20 characters)" 
                   value="" 
                   onkeypress="handleEnterKey(event)"
                   class="w-full p-2 border border-gray-300 rounded mb-2 focus:outline-none focus:ring-2 focus:ring-blue-500">
            <button onclick="guestLogin()" 
                    id="login-btn"
                    class="w-full bg-blue-500 text-white py-2.5 px-5 rounded cursor-pointer border-none mt-2.5 hover:bg-blue-600 transition-colors disabled:bg-gray-500 disabled:cursor-not-allowed">
                Start Game as Guest
            </button>
            <div id="auth-status"></div>
        </div>
        
        <!-- Game Area -->
        <div class="flex gap-5 mt-5" id="game-area" style="display: none;">
            <!-- Map -->
            <div class="flex-1 border-2 border-gray-800 map-container relative w-150 h-96 overflow-hidden rounded-lg">
                <div class="trainer w-5 h-5 bg-trainer-red border-2 border-white rounded-full transition-all duration-300 ease-out z-10" 
                     id="trainer" 
                     style="left: 50%; top: 50%;"
                     data-x="15.0" data-y="10.0">
                </div>
            </div>
            
            <!-- Controls -->
            <div class="flex-none w-75 bg-white p-5 rounded-lg shadow-lg">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">Movement Controls</h3>
                
                <div class="grid grid-cols-3 gap-1.5 my-5 max-w-38">
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(-1, -1)">↖</button>
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(0, -1)">↑</button>
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(1, -1)">↗</button>
                    
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(-1, 0)">←</button>
                    <button class="w-10 h-10 border-none rounded bg-gray-500 text-white cursor-pointer text-lg transition-all duration-200">■</button>
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(1, 0)">→</button>
                    
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(-1, 1)">↙</button>
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(0, 1)">↓</button>
                    <button class="w-10 h-10 border-none rounded bg-blue-500 text-white cursor-pointer text-lg transition-all duration-200 hover:bg-blue-600 hover:scale-110 active:scale-95 disabled:bg-gray-400 disabled:cursor-not-allowed disabled:transform-none" onclick="move(1, 1)">↘</button>
                </div>
                
                <button onclick="stopMovement()"
                        class="w-full bg-red-600 text-white py-2.5 px-4 rounded cursor-pointer text-lg border-none mt-2.5 transition-all duration-200 hover:bg-red-700">
                    🛑 Stop Movement
                </button>
                
                <button onclick="fetchPosition()"
                        class="w-full bg-green-600 text-white py-2 px-4 rounded cursor-pointer border-none mt-2.5 transition-colors hover:bg-green-700">
                    🔄 Sync Position
                </button>
                
                <button onclick="logout()"
                        class="w-full bg-red-600 text-white py-2 px-4 rounded cursor-pointer border-none mt-2.5 transition-colors hover:bg-red-700">
                    🚪 Logout
                </button>
                
                <div class="mt-5 p-2.5 bg-gray-50 rounded text-xs font-mono" id="status">
                    <div><strong>Position:</strong> <span id="pos-x">15.0</span>, <span id="pos-y">10.0</span></div>
                    <div><strong>Moving:</strong> <span id="is-moving">false</span></div>
                    <div><strong>Direction:</strong> <span id="direction">0, 0</span></div>
                    <div><strong>Speed:</strong> <span id="speed">2.0</span> units/sec</div>
                    <div><strong>Last Update:</strong> <span id="last-update">-</span></div>
                </div>
                
                <div id="error-msg"></div>
            </div>
        </div>
    </div>

    <script src="trainer-client.js"></script>
</body>
</html>